<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC
    "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="jp.co.myapp.api.domain.repository.cancelkeijo.CancelKeijoRepository">
    
    <select id="findAll" parameterType="jp.co.myapp.api.app.request.CancelKeijoRequest" resultMap="jp.co.myapp.api.domain.repository.entrydetailmaster.EntryDetailMasterRepository.entryManagementMap">
    <![CDATA[
    	SELECT
            POLICY,
            KEIJYOU_STATUS,
            upd_date
        FROM
            ENTRY_HA 
        WHERE
        	1 = 1
    ]]>
            <if test="policyNo != null and policyNo.length != 0">
	<![CDATA[
				AND policy IN 
    ]]>
        		<foreach collection="policyNo" item="item" open="(" separator="," close=")">  
			        #{item}  
			    </foreach> 
			</if>
			
    </select>
    
    <update id="updateEntry" parameterType="EntryManagementBean">
    <![CDATA[
      UPDATE
            ENTRY_HA 
        SET
            KEIJYOU_STATUS ='9',
            UPD_PROC_ID = 'MG2_O_0003',
            UPD_DATE = #{newDate}
        WHERE
            POLICY = #{policyNo}
            AND UPD_DATE = #{updateTime}
            AND KEIJYOU_STATUS = '1'
                  									            
    ]]>
    </update>
    
</mapper>
