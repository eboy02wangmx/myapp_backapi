<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC
    "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="jp.co.myapp.api.domain.repository.album.AlbumRepository">

	<select id="getAlbum" parameterType="String" resultType="jp.co.myapp.api.domain.model.AlbumBean">
    	SELECT
    		vi.id,
		    vi.filename,
		    vi.bukenme,
		    vi.userid,
		    vi.shoyusha,
		    vi.yukokbn,
		    vi.sakusesha,
		    DATE_FORMAT(vi.sakusehi,'%Y-%m-%d %H:%i:%s') as sakusehi,
		    vi.koushinsha,
		    DATE_FORMAT(vi.koushinhi,'%Y-%m-%d %H:%i:%s') as koushinhi,
		    vi.picnum,
		    ui.customid,
		    vi.domain
		FROM
		    innodb.vr_info vi
		        LEFT JOIN
		    innodb.user_info ui ON vi.userid = ui.userid
		WHERE
		    ui.customid = (SELECT customid FROM user_info WHERE userid = #{userid})
	</select>

	<update id="updateDomain">
		update innodb.vr_info set domain = #{domain} where id = #{id}
	</update>

	<delete id="removeAlbum" parameterType="String">
		delete from innodb.vr_info where filename = #{filename}
	</delete>

	<insert id="createAlbum" parameterType = "jp.co.myapp.api.app.request.AlbumCreateRequest">
		insert into innodb.vr_info (
			filename,
			bukenme,
			userid,
			sakusehi,
			koushinhi,
			picnum
		) values (
			NOW(),
			#{bukenme},
			#{userid},
			SYSDATE(),
			SYSDATE(),
			0
		)
	</insert>

</mapper>
