<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC
    "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="jp.co.myapp.api.domain.repository.userkanri.UserKanriRepository">

	<resultMap id="userKanriMap" type="UserKanriBean">
		<id property="userid" column="userid" javaType="java.lang.String"></id>
		<result property="userid" column="userid" javaType="java.lang.String"></result>
		<result property="kengen" column="kengen" javaType="java.lang.String"></result>
		<result property="yukokbn" column="yukokbn" javaType="java.lang.String"></result>
		<result property="systemdate" column="systemdate" javaType="java.lang.String"></result>
		<result property="picnum" column="picnum" javaType="java.lang.String"></result>
	</resultMap>


    <select id="getUserkanriInfo" parameterType="String" resultMap="userKanriMap">

            SELECT
			user_info.userid,
			user_info.kengen,
			user_info.yukokbn,
			user_info.systemdate,
			sum(vr_info.picnum) picnum
			FROM
				user_info
			left join
				vr_info
			on vr_info.userid = user_info.userid
			WHERE
            user_info.customid = (
                                    select user_info.customid
                                    from user_info
                                    where user_info.userid = #{userId}
                                    )

            group by user_info.userid

    </select>
        <select id="getAdminInfo" parameterType="String" resultMap="userKanriMap">

            SELECT
			user_info.userid,
			user_info.kengen,
			user_info.yukokbn,
			user_info.systemdate,
			sum(vr_info.picnum) picnum
			FROM
				user_info
			left join
				vr_info
			on vr_info.userid = user_info.userid
			group by userid

    </select>

    <update id="createUser" parameterType = "jp.co.myapp.api.app.request.UserCreateRequest">
    update innodb.user_info set
	shimekana = concat(#{furiganase},#{furiganame}),
	shimekanji = concat(#{kanjise},#{kanjime}),
	password = #{password}
	where userid = #{userid}

	</update>

    <insert id="insertUser" parameterType = "jp.co.myapp.api.app.request.UserCreateRequest">

		insert into innodb.user_info
		(
        userid,
		shimekana,
		shimekanji,
		password
		)
	values
		(
		#{userid},
		concat(#{furiganase},#{furiganame}),
		concat(#{kanjise},#{kanjime}),
		#{password}
		)
    </insert>

    <delete id="deleteUser" parameterType="String">
	delete from innodb.user_info where userid = #{userid}
	</delete>
</mapper>
