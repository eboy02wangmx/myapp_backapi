<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC
    "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="jp.co.myapp.api.domain.repository.entrylistmaster.EntryListMasterRepository">

   <select id="findCount" parameterType="jp.co.myapp.api.app.request.EntryListRequest" resultType="int">
    <![CDATA[
        SELECT
        	count(1) AS cnt
        FROM
            ENTRY_HA 
        WHERE
        	1 = 1
    ]]>
    <include refid="entrymanagementwhere"/>      
    </select>

    <select id="findAll" parameterType="jp.co.myapp.api.app.request.EntryListRequest" resultMap="jp.co.myapp.api.domain.repository.entrydetailmaster.EntryDetailMasterRepository.entryManagementMap">
    <![CDATA[
    	SELECT
            no,
            policy,
            keijyou_status,
            entry_type,
            payment_type,
            entry_date,
            entry_jikan,
            name_keiyaku,
            shiki_date,
            kasai_hoho,
            jishin_hoho,
            sentaku_plan,
            uke_kbn,
            hryo,
            katen_cd,
            dairi_cd,

            tate_keitai,
            shozai,
            kasai_hkikan,
			jishin_hkikan,
            katen_name,
            dairi_name,

            upd_date
    	FROM (
    	SELECT
    	    ROW_NUMBER() OVER(ORDER BY entry_date DESC, entry_jikan DESC, shiki_date DESC) AS no,
            policy,
            keijyou_status,
            entry_type,
            payment_type,
            entry_date,
            entry_jikan,
            name_keiyaku,
            shiki_date,
            kasai_hoho,
            jishin_hoho,
            sentaku_plan,
            uke_kbn,
            hryo,
            katen_cd,
            dairi_cd,

            tate_keitai,
            shozai,
            kasai_hkikan,
			jishin_hkikan,
            katen_name,
            dairi_name,

            upd_date
        FROM
            ENTRY_HA 
        WHERE
        	1 = 1
    ]]>
    <include refid="entrymanagementwhere"/>    
	<![CDATA[
        )
        WHERE
        	1 = 1
    ]]>
			<if test="rownoStart != null and rownoStart != 0">
	<![CDATA[
        	AND no >= #{rownoStart}
    ]]>
			</if>
			<if test="rownoEnd != null and rownoEnd != 0">
	<![CDATA[
        	AND no <= #{rownoEnd}
    ]]>
			</if>
    </select>
    
    <select id="findCSVList" parameterType="jp.co.myapp.api.app.request.EntryListRequest" resultType="jp.co.myapp.api.domain.model.EntryCSVBean">
    <![CDATA[
	   	SELECT
	       	policy,
			entry_no,
			keijyou_status,
			open_id,
			entry_type,
			payment_type,
			check_date,
			check_jikan,
			entry_date,
			entry_jikan,
			name_keiyaku,
			name_keiyaku_k,
			yubin_keiyaku,
			jusho_code_keiyaku,
			jusho_keiyaku,
			jusho_keiyaku_free,
			jusho_keiyaku_k,
			jusho_keiyaku_k_free,
			tel_keiyaku_area,
			tel_keiyaku_city,
			tel_keiyaku_number,
			tel_keiyaku2_area,
			tel_keiyaku2_city,
			tel_keiyaku2_number,
			mail_keiyaku,
			mail_send_flg,
			seibetsu_keiyaku,
			birthday_keiyaku,
			keiyaku_hiho_onaji,
			name_hiho,
			name_hiho_k,
			name_baisho_kojin,
			name_baisho_kojin_k,
			name_baisho_syakuya,
			name_baisho_syakuya_k,
			name_baisho_kanri,
			name_baisho_kanri_k,
			shiki_date,
			shiki_jikan,
			kasai_shuki_date,
			kasai_shuki_jikan,
			jishin_shuki_date,
			jishin_shuki_jikan,
			tate_shoyu,
			tate_keitai,
			kaisu_chijo,
			kaisu_chika,
			kaisu_kyoju,
			tate_kouzou,
			kouzou_tekin,
			kouzou_other,
			grade,
			shozai,
			kenchiku_ym_seireki,
			area,
			tate_kanyu,
			jyulon_riyo,
			hyokagaku_humei,
			saichotatu_gaku,
			monhei_gaku,
			shinchiku_gaku,
			hyoka_kijun,
			kazai_kanyu,
			setai_nenrei,
			kodomo_ninzu,
			haigusha,
			doukyo_ninzu,
			tate_hyoka_gaku_low,
			tate_hyoka_gaku_up,
			kazai_hyoka_gaku_low,
			kazai_hyoka_gaku_up,
			tate_jishin_kanyu,
			kazai_jishin_kanyu,
			kakunin_shorui,
			jishin_waribikiritsu,
			taishin,
			taishin_date,
			inc_kiso,
			inc_tatami,
			inc_monhei,
			inc_shako,
			inc_kyoyo,
			kasai_hkikan,
			jishin_hkikan,
			jishin_jidokeizoku,
			kasai_hoho,
			jishin_hoho,
			sentaku_plan,
			fire_hosho,
			husai_hosho,
			husai_gaku,
			suisai_hosho,
			tonan_hosho,
			hason_hosho,
			hason_hutan,
			hason_limit,
			jishin_hosho_tate,
			jishin_hosho_kazai,
			saigai_hosho,
			saigai_limit,
			hiyou_hosho,
			toku_kojinbaisho,
			toku_syakuyabaisho,
			toku_syakuyabaisho_limit,
			toku_tatebaisho,
			toku_tatebaisho_limit,
			toku_ruisho,
			toku_tatekae,
			toku_kyoyo,
			toku_bohan,
			toku_motidashi,
			toku_hikoshi,
			gaku_kasai_tate,
			gaku_kasai_kazai,
			gaku_jishin_tate,
			gaku_jishin_tate_low,
			gaku_jishin_tate_up,
			gaku_jishin_kazai,
			gaku_jishin_kazai_low,
			gaku_jishin_kazai_up,
			hryo_kasai_tate,
			hryo_kasai_kazai,
			hryo_kasai,
			hryo_jishin_tate,
			hryo_jishin_kazai,
			hryo_jishin,
			hryo_kojinbai,
			hryo_shakuyabai,
			hryo_ruisho,
			hryo_nengaku,
			hryo_shokai,
			hryo,
			jusho_onaji,
			yubin_hoken,
			jusho_code_hoken,
			jusho_hoken,
			jusho_hoken_free,
			jusho_hoken_k,
			jusho_hoken_k_free,
			jishin_kakunin,
			youhou,
			shokusagyo,
			setuj_kanyu,
			setuj_hyoka_gaku,
			setuj_gaku,
			seihn_kanyu,
			seihn_hyoka_gaku,
			seihn_gaku,
			mb_hyoka_gaku,
			mb_gaku,
			bnt_kbn,
			wari_kbn,
			hknj1_katen_cd,
			hknj1_dairi_cd,
			hknj1_jiko,
			hknj1_bnt_wari,
			hknj2_katen_cd,
			hknj2_dairi_cd,
			hknj2_jiko,
			hknj2_bnt_wari,
			uke_kbn,
			katen_cd,
			
			katen_name,
			
			dairi_cd,
			dairi_name,
			shichiken_umu,
			teito_umu,
			betudou,
			tanto_cd,
			bnt_umu,
			toki_k,
			bosyunin_id,
			yushi_umu,
			koza_henko,
			hagaki,
			policy_old,
			jt_kbn,
			mb_shosai_umu,
			hryo_setuj,
			hryo_seihn,
			hryo_mb,
			pattern_cd,
			upd_proc_id,
			upd_date,
			add_proc_id,
			add_date
		FROM
			ENTRY_HA 
	    WHERE
			1 = 1]]>
	    <include refid="entrymanagementwhere"/>    
		<![CDATA[
		ORDER BY
	    	entry_date DESC,
	    	entry_jikan DESC,
			shiki_date DESC
    ]]>
    </select>
    
    <sql id="entrymanagementwhere">
    <if test="policyNo != null and policyNo != ''">
	<![CDATA[
				AND policy = #{policyNo}
    ]]>
			</if>
			<if test="appropriationStatus != null and appropriationStatus.length != 0">
	<![CDATA[
				AND keijyou_status IN 
    ]]>
        		<foreach collection="appropriationStatus" item="item" open="(" separator="," close=")">  
			        #{item}  
			    </foreach> 
			</if>
			<if test="entryType != null and entryType.length != 0">
	<![CDATA[
				AND entry_type IN 
    ]]>
    			<foreach collection="entryType" item="item" open="(" separator="," close=")">  
			        #{item}  
			    </foreach> 
			</if>
			<if test="paymentType != null and paymentType.length != 0">
	<![CDATA[
				AND payment_type IN 
    ]]>
        		<foreach collection="paymentType" item="item" open="(" separator="," close=")">  
			        #{item}  
			    </foreach> 
			</if>
			<if test="entryDateStart != null and entryDateStart != ''">
	<![CDATA[
				AND entry_date >= #{entryDateStart}
    ]]>
			</if>
			<if test="entryDateEnd != null and entryDateEnd != ''">
	<![CDATA[
				AND entry_date <= #{entryDateEnd}
    ]]>
			</if>
			<if test="startDateFrom != null and startDateFrom != ''">
	<![CDATA[
				AND shiki_date >= #{startDateFrom}
    ]]>
			</if>
			<if test="startDateTo != null and startDateTo != ''">
	<![CDATA[
				AND shiki_date <= #{startDateTo}
    ]]>
			</if>
			<if test="contractorNameKana != null and contractorNameKana != ''">
			<bind name="toContractorNameKana" value="@org.terasoluna.gfw.common.query.QueryEscapeUtils@toContainingCondition(contractorNameKana)" />
	<![CDATA[
				AND name_keiyaku_k like #{toContractorNameKana} ESCAPE '~'
    ]]>
            </if>
            <if test="firePaymentMethodSql != null and firePaymentMethodSql != ''">
	<![CDATA[
				AND ${firePaymentMethodSql}
    ]]>
			</if>
			<if test="earthquakePaymentMethodSql != null and earthquakePaymentMethodSql != ''">
	<![CDATA[
				AND ${earthquakePaymentMethodSql}
    ]]>
			</if>
			<!-- <if test="firePaymentMethod != null and firePaymentMethod.length != 0">
			</foreach>
	<![CDATA[
				AND kasai_hoho IN 
    ]]>
        		<foreach collection="firePaymentMethod" item="item" open="(" separator="," close=")">  
			        #{item}  
			    </foreach> 
			</if>
			<if test="earthquakePaymentMethod != null and earthquakePaymentMethod.length != 0">
	<![CDATA[
				AND jishin_hoho IN 
    ]]>
        		<foreach collection="earthquakePaymentMethod" item="item" open="(" separator="," close=")">  
			        #{item}  
			    </foreach> 
			</if> -->
			
			<!-- <if test="salesCode != null and salesCode != ''">
				<![CDATA[ AND katen_cd = #{salesCode} ]]>
			</if> -->
			<if test="salesCode != null and salesCode != '' and salesCode.length != 0"><![CDATA[
				AND katen_cd IN 
    ]]><foreach collection="salesCode" item="item" open="(" separator="," close=")">  
                #{item}ã€€
    </foreach></if>
    
			<!--<if test="agentCode != null and agentCode != '' and agentCode.length != 0"><![CDATA[
                AND TRIM(dairi_cd) IN  
    ]]><foreach collection="agentCode" item="item" open="(" separator="," close=")">  
                #{item}  
    </foreach></if>-->
    <if test="agentCodeSql != null and agentCodeSql != ''">
	        <![CDATA[ AND (TRIM(dairi_cd) IN ${agentCodeSql}) ]]>
	    </if> 
    </sql>
</mapper>
